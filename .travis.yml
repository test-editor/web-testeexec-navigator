dist: trusty
sudo: false
language: node_js
node_js:
- '9'
os:
- linux
cache: yarn

env:
  global: 
    - # Environment variables for NPM version patch    
    - secure: "Tx6J7Xk2F16TtvQfhTBRoegG7sNp5N2cMC5I9Ky+CP3wI32qepffGTfoX0j+hWnj+HuAdTMkiC8mie4mHICUoL+5VmdkgYePyrV7zRxVpSq26M+zWzIRHZ7kJbd1OfzBx9IdMKfRNX/JFkHMavhDKDtv23QbtadEWIbmaZiemZSvv99AZwcj0hD/xgIq31SRndg7SrBsQ8qHPqW7ambK4sz/rI8ngYoxcoPfOWFJgT9Mm0M1HVH2tGXe081mF1DyRgJRVJ0t5X5BP2aIiKUstqObagiH1TU4K3x8GacnHyfiEwve8RNUmnC0mf38cLyJXRcbprcrkQKbavtZuEtto6Z+Zvxuow5xe0uAY5NvIwEQcIxhp4/oFI2byUGCBKrcmsk1qZLekz+2S4VgmvN+DIdv0+k7O5jlwWZH/6aGf6+mC/T2MhBCexURRqSEMARE8tko2RxoF0Xl5ExbgOy7tPZaGd4lt4U3Sb84KXX2oJN2VcdQtotd91vGHAPecfdJQVCDA7V6t58mingxo2zqpr0ZmZsghc9Qz/VCGjUPxpD1rdH3lir8B/fxBkWm4l19V0FPXbXduz/xK5hE3dLm3f3BEihLXJc/fltgpA8qy3dXzemF9vOEfiAsJj7RVn3jUKbxmgXnPXWBXPLiov3F1PTEtMewAzP86TXNw8KyN64="
    - secure: "mHBtDmdMT0q9hBgjf6Th31mUrn4Z6FbDshF7mFTMHAXmsB4iHPxV9HkGji2DJAlULlwYWyWdDAwX2B7U9OCwfXxwWmgTb6Mntwdr4SHVVGu1iQdoomzbmvpITB+XkxBbCptAQ2h5/163iABAhm4dVi3k79PLA1gnAQEG++uNCLX/3kNaoWyw0bhJuFqparOXU386PcZbyJYltWo+V/OdeosgVRj5NxKMAOlcdBes64BzZ3N6aGfdIvbahHLiMbM3Yw6f3VkYYTvbcgMtj9xwhIKZpPpW7XTAXyHVKerran68mIYmLlhoLCQsvu0x7kRS0oqITc2SzjGQ/KAm7cdLiX1pop7uu4RyOAuTIe0JCjzSqB5MD8X/g8577QUer3vY/q+rJct6bdonZhnvSrWudU6iq80kCnazsuPgNjv9kJNiOQeS8v+A0DovZX5dR6kIILVyyIPmsT5PWa3DG8QFgFG7LfVVajpw6SI4aRJCrHbUKHG1DzQ2MLVRN6vyru4sxOpOVjQ2JgZoT/kHhKV3pq2L1UNESiL8mgSABijCQJiNkrqrQQyLzvB4okGJd5Tewh+NdG8krgmfoxBIaMbAUZWvkMW7EyLZo687f1tbRGNgZ+XjmDP9HtmZOgvXLIO3mmU3WXKW1aeBblwchgZdij3uC64SbBRdBuSR/h99x3A=" 

  matrix:
    - FIREFOX_VERSION="latest"
    - FIREFOX_VERSION="61.0.2"

before_install:
- echo $FIREFOX_VERSION
- export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
- wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
- mkdir /tmp/firefox-$FIREFOX_VERSION
- tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
- export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- export CHROME_BIN=/usr/bin/google-chrome
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.6.0
- export PATH="$HOME/.yarn/bin:$PATH"
- sudo apt-get update
- sudo apt-get install -y libappindicator1 fonts-liberation google-chrome-stable
install:
- yarn install
script:
- firefox --version
- npm run lint
- npm run test:once
- npm run e2e
after_success:
- npm run packagr
# Autoincrement of patch level version:
# Tag the repo with a new patch level version tag, if this build is done on
#     'FIREFOX_VERSION = latest' and (only one of the matrix-builds is relevant)
#     this is not a pull request and (pull requests themselves should not autoincrement)
#     this branch is the master branch and (only builds on master are relevant)
#     there is no tag given (if a tag is alread given, this one will be published and should not again be tagged!)
- 'if [ "$FIREFOX_VERSION" = "latest" -a "$TRAVIS_PULL_REQUEST" = "false" -a "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_TAG" = "" ]; then wget https://github.com/test-editor/commons-build-automation/raw/master/travis/deploy/tag_with_new_patch_version.sh; bash tag_with_new_patch_version.sh; fi'
before_deploy:
- touch .npmignore
- cd dist/
deploy:
  skip_cleanup: true
  provider: npm
  email: service.eng@akquinet.de
  api_key:
    secure: "cK64qTE9RndpQgL/GDIj2nGyrHGLgm4os2GQa1CpRutolGUn/QauyxNVYqCEhNdD/IG4J+BJdsUsjLP/ymJ5Ox22c6w/24W/3LNx4o+1dyccJGBssMczK47ENlN8Uto3gjgnbmq+N1hQskP8HsdAKZ7ec1dQuAANBbIMXphlDfoGjzSrePyjrQZxjeQQ8zPtR3U1Hsxj/cChFPrJDh3fBtJfdcmiwrOe6Ri4Ku4yM8NBXES7k4a06SgXTz8BeBqJ8mr2jz3LcPY17v73FNYKmHfkKevTb11MpMIS8xnUoe7S7v32TCoJd2HniekxCZn7LLnceXCERNWojE4wSxmLNOkKT1eio6f4Yjes7PETgac5GQJ8bEhuY0AHhB31JdDOHvFAlgs9zCh+wX/6zr8hW723SbStmbIHT9i/nQGozWqH2HY3jO1+CZtpjbGc3NMnkuBgae2hYmvfgaAojchSkc9saoxfnG2K7y85kD4nGQ5818igt3JFHlaTKEGQvd1xU/g7han95p1Q4m45cVxyGpSftAUgwU+Gi81B0r8cyH8F3ZuRWyvArv82ZsTYjH32Gqw81g8DlZjJZcVPhFwrUq324qwNg1/U80DFLlYE0Qc6yx29IN5gaAa0YlgqJFXLKu1nf94+7TAtw/yKDzyjJqsL+r728RtFXkYXt0yqazY="
  on:
    condition: "$FIREFOX_VERSION = latest"
    tags: true
    repo: test-editor/web-testexec-navigator
